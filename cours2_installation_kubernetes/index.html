<!doctype html><html lang=fr dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.111.3"><meta name=generator content="Relearn 5.12.5+tip"><meta name=description content="TP - Intro à k8s"><meta name=author content="Alexandre P."><title>Installer Kubernetes - Introduction à Kubernetes</title><link href=../cours2_installation_kubernetes/index.xml rel=alternate type=application/rss+xml title="Installer Kubernetes - Introduction à Kubernetes"><link href=../css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../css/fontawesome-all.min.css rel=stylesheet></noscript><link href=../css/nucleus.css rel=stylesheet><link href=../css/auto-complete.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../css/auto-complete.css rel=stylesheet></noscript><link href=../css/perfect-scrollbar.min.css rel=stylesheet><link href=../css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../css/fonts.css rel=stylesheet></noscript><link href=../css/theme.css rel=stylesheet><link href=../css/theme-blue.css rel=stylesheet id=variant-style><link href=../css/variant.css rel=stylesheet><link href=../css/print.css rel=stylesheet media=print><link href=../css/ie.css rel=stylesheet><script src=../js/url.js></script>
<script src=../js/variant.js></script>
<script>window.index_js_url="../index.search.js";var root_url="../",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copier dans le presse-papiers",window.T_Copied_to_clipboard="Copié dans le presse-papiers!",window.T_Copy_link_to_clipboard="Copier le lien dans le presse-papiers",window.T_Link_copied_to_clipboard="Lien copié dans le presse-papiers!",window.T_No_results_found="Aucun résultat trouvé pour \u0022{0}\u0022",window.T_N_results_found="{1} résultats trouvés pour \u0022{0}\u0022",baseUriFull="https://zaggash.github.io/tp-iut-kubernetes/",window.variants&&variants.init(["blue"])</script></head><body class="mobile-support html" data-url=../cours2_installation_kubernetes/><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div class=navigation><a class="nav nav-next topbar-link" href=../td1-installation/ title="TD - Installation et Configuration (&#129106;)"><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><a class="nav nav-prev topbar-link" href=../cours1_presentation_kubernetes/ title="Presentation de Kubernetes (&#129104;)"><i class="fas fa-chevron-left fa-fw"></i></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span>
<span id=toc-menu title='Table des matières (CTRL+ALT+t)'><i class="fas fa-list-alt fa-fw"></i></span>
<span class=links>Installer Kubernetes</span></div><div class="default-animation progress"><div class=toc-wrapper><nav id=TableOfContents><ul><li><a href=#architecture-de-kubernetes>Architecture de Kubernetes</a><ul><li></li><li><a href=#le-control-plane>Le Control Plane</a></li></ul></li><li><a href=#le-client-kubectl>Le client <code>kubectl</code></a></li><li><a href=#installation-de-développement>Installation de développement</a></li><li><a href=#cluster-dans-le-cloud-managed-cluster>Cluster dans le Cloud (<em>managed cluster</em>)</a></li><li><a href=#installer-un-cluster-de-production>Installer un cluster de production</a></li><li><a href=#installer-un-cluster-complètement-à-la-main-pour-sexercer>Installer un cluster complètement à la main pour s&rsquo;exercer</a></li></ul></nav></div></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags></div><article class=default><h1 id=installer-kubernetes>Installer Kubernetes</h1><h2 id=architecture-de-kubernetes>Architecture de Kubernetes</h2><h5 id=kubernetes-master>Kubernetes master</h5><ul><li><p>Le Master est responsable du maintien de l’état souhaité pour votre cluster.<br>Lorsque vous interagissez avec Kubernetes, par exemple en utilisant l’interface en ligne de commande kubectl, vous communiquez avec le master Kubernetes de votre cluster.</p></li><li><p>Le “master” fait référence à un ensemble de processus gérant l’état du cluster. Le master peut également être répliqué pour la disponibilité et la redondance.</p></li></ul><h5 id=noeuds-kubernetes>Noeuds Kubernetes</h5><p>Les nœuds d’un cluster sont les machines (serveurs physiques, machines virtuelles, etc.) qui exécutent vos applications et vos workflows.<br>Le master node Kubernetes contrôle chaque noeuds; vous interagirez rarement directement avec les nœuds.</p><p><a href=#image-26680bd7a32a1f7a5cbdc4949812536b class=lightbox-link><img src=./k8s_archi1.png alt style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-26680bd7a32a1f7a5cbdc4949812536b><img src=./k8s_archi1.png alt class=lightbox-image loading=lazy></a></p><ul><li><p>Pour utiliser Kubernetes, vous utilisez les objets de l’API Kubernetes pour décrire l’état souhaité de votre cluster: quelles applications ou autres processus que vous souhaitez exécuter, quelles images de conteneur elles utilisent, le nombre de réplicas, les ressources réseau et disque que vous mettez à disposition, et plus encore.</p></li><li><p>Vous définissez l’état souhaité en créant des objets à l’aide de l’API Kubernetes, généralement via l’interface en ligne de commande, <code>kubectl</code>. Vous pouvez également utiliser l’API Kubernetes directement pour interagir avec le cluster et définir ou modifier l’état souhaité.</p></li><li><p>Une fois que vous avez défini l’état souhaité, le plan de contrôle Kubernetes (control plane) permet de faire en sorte que l’état actuel du cluster corresponde à l’état souhaité. Pour ce faire, Kubernetes effectue automatiquement diverses tâches, telles que le démarrage ou le redémarrage de conteneurs, la mise à jour du nombre de <em>replicas</em> d’une application donnée, etc.</p></li></ul><h3 id=le-control-plane>Le Control Plane</h3><ul><li><p>Le control plane Kubernetes comprend un ensemble de processus en cours d’exécution sur votre cluster:</p><ul><li><p>Le master Kubernetes est un ensemble de trois processus qui s’exécutent sur un seul nœud de votre cluster, désigné comme nœud maître (<em>master node</em> en anglais). Ces processus sont:</p><ul><li><code>kube-apiserver</code>: expose l&rsquo;API pour parler au cluster</li><li><code>kube-controller-manager</code>: basé sur une boucle qui controlle en permanence l&rsquo;état des resources et essaie de le corriger s&rsquo;il n&rsquo;est plus conforme.</li><li><code>kube-scheduler</code>: monitore les resources des différents workers, décide et cartographie ou doivent être créé les conteneur(Pods)</li></ul></li><li><p>Chaque nœud non maître de votre cluster exécute deux processus :
<code>kubelet</code>, qui communique avec le Kubernetes master et controle la création et l&rsquo;état des pods sur son noeud.
<code>kube-proxy</code>, un proxy réseau reflétant les services réseau Kubernetes sur chaque nœud.</p></li></ul></li></ul><p>Les différentes parties du control plane Kubernetes, telles que les processus <code>kube-controller-manager</code> et <code>kubelet</code>, déterminent la manière dont Kubernetes communique avec votre cluster.</p><p>Le control plane conserve un enregistrement de tous les objets Kubernetes du système et exécute des boucles de contrôle continues pour gérer l’état de ces objets. À tout moment, les boucles de contrôle du control plane répondent aux modifications du cluster et permettent de faire en sorte que l’état réel de tous les objets du système corresponde à l’état souhaité que vous avez fourni.</p><p>Par exemple, lorsque vous utilisez l’API Kubernetes pour créer un objet <code>Deployment</code>, <strong>vous fournissez un nouvel état souhaité pour le système</strong>. Le control plane Kubernetes enregistre la création de cet objet et exécute vos instructions en lançant les applications requises et en les planifiant vers des nœuds de cluster, afin que l’état actuel du cluster corresponde à l’état souhaité.</p><h2 id=le-client-kubectl>Le client <code>kubectl</code></h2><p>&mldr;Permet depuis sa machine de travail de contrôler le cluster avec une ligne de commande qui ressemble un peu à celle de Docker:</p><ul><li>Lister les ressources</li><li>Créer et supprimer les ressources</li><li>Gérer les droits d&rsquo;accès</li><li>etc.</li></ul><p>Cet utilitaire s&rsquo;installe avec un gestionnaire de paquet classique mais est souvent fourni directement par une distribution de développement de kubernetes.</p><p>Pour se connecter, <code>kubectl</code> a besoin de l&rsquo;adresse de l&rsquo;API Kubernetes, d&rsquo;un nom d&rsquo;utilisateur et d&rsquo;un certificat.</p><ul><li>Ces informations sont fournies sous forme d&rsquo;un fichier YAML appelé <code>kubeconfig</code></li><li>Comme nous le verrons en TP ces informations sont généralement fournies directement par le fournisseur d&rsquo;un cluster k8s (provider ou k8s de dev)</li></ul><p>Le fichier <code>kubeconfig</code> par défaut se trouve sur Linux à l&rsquo;emplacement <code>~/.kube/config</code>.</p><p>On peut aussi préciser la configuration au <em>runtime</em> comme ceci: <code>kubectl --kubeconfig=fichier_kubeconfig.yaml &lt;commandes_k8s></code></p><p>Le même fichier <code>kubeconfig</code> peut stocker plusieurs configurations dans un fichier YAML :</p><p>Exemple :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>clusters</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>cluster</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>certificate-authority</span>: <span style=color:#ae81ff>/home/jacky/.minikube/ca.crt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://172.17.0.2:8443</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>minikube</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>cluster</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>certificate-authority-data</span>: <span style=color:#ae81ff>LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKekNDQWcrZ0F3SUJBZ0lDQm5Vd0RRWUpLb1pJaHZjTkFRRUxCUUF3TXpFVk1CTUdBMVVFQ2hNTVJHbG4KYVhSaGJFOWpaV0Z1TVJvd0dBWURWUVFERXhGck9&lt;clipped&gt;3SCsxYmtGOHcxdWI5eHYyemdXU1F3NTdtdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://5ba26bee-00f1-4088-ae11-22b6dd058c6e.k8s.ondigitalocean.com</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>do-lon1-k8s-tp-cluster</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>contexts</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>context</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>minikube</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>minikube</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>minikube</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>context</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cluster</span>: <span style=color:#ae81ff>do-lon1-k8s-tp-cluster</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>do-lon1-k8s-tp-cluster-admin</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>do-lon1-k8s-tp-cluster</span>
</span></span><span style=display:flex><span><span style=color:#f92672>current-context</span>: <span style=color:#ae81ff>do-lon1-k8s-tp-cluster</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>preferences</span>: {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>users</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>do-lon1-k8s-tp-cluster-admin</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>user</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>token</span>: <span style=color:#ae81ff>8b2d33e45b980c8642105ec827f41ad343e8185f6b4526a481e312822d634aa4</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>minikube</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>user</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>client-certificate</span>: <span style=color:#ae81ff>/home/jacky/.minikube/profiles/minikube/client.crt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>client-key</span>: <span style=color:#ae81ff>/home/jacky/.minikube/profiles/minikube/client.key</span>
</span></span></code></pre></div><p>Ce fichier déclare 2 clusters (un local, un distant), 2 contextes et 2 users.</p><h2 id=installation-de-développement>Installation de développement</h2><p>Pour installer un cluster de développement :</p><ul><li>Minikube, tourne dans Docker par défaut (ou dans des VMs)</li><li>solution très pratique et vanilla: kind</li><li>avec Docker Desktop depuis peu (dans une VM aussi)</li><li>un cluster léger avec <code>k3s</code>, de Rancher (simple et utilisable en production/edge)</li></ul><h2 id=cluster-dans-le-cloud-managed-cluster>Cluster dans le Cloud (<em>managed cluster</em>)</h2><p>Tous les principaux provider de cloud fournissent depuis plus ou moins longtemps des solutions de cluster gérées par eux :</p><ul><li>Google Cloud Plateform avec Google Kubernetes Engine (GKE) : très populaire car très flexible et l&rsquo;implémentation de référence de Kubernetes.</li><li>AWS avec EKS : Kubernetes assez standard mais à la sauce Amazon pour la gestion de l&rsquo;accès, des loadbalancers ou du scaling.</li><li>Azure avec AKS : Kubernetes assez standard mais à la sauce Amazon pour la gestion de l&rsquo;accès, des loadbalancers ou du scaling.</li><li>DigitalOcean ou Scaleway : un peu moins de fonctions mais plus simple à appréhender</li></ul><h2 id=installer-un-cluster-de-production>Installer un cluster de production</h2><p>L&rsquo;installation est décrite dans la <a href=https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/ target=_blank>documentation officielle</a></p><p>Opérer et maintenir un cluster de production Kubernetes &ldquo;à la main&rdquo; est très complexe et une tâche à ne pas prendre à la légère. De nombreux éléments doivent être installés et géré par les opérateurs.</p><ul><li>Mise à jour et passage de version de kubernetes qui doit être fait très régulièrement car une version n&rsquo;est supportée que 2 ans.</li><li>Choix d&rsquo;une configuration réseau et de sécurité adaptée.</li><li>Installation probable de système de stockage distribué comme Ceph à maintenir également dans le temps</li><li>Installer le dæmon Kubelet sur tous les noeuds</li><li>Générer les bons certificats</li><li>Installer un réseau CNI k8s comme flannel (d’autres sont possible et le choix vous revient)</li><li>Déployer la base de données etcd</li><li>Connecter les nœuds worker au master.</li><li>&mldr;</li></ul><h2 id=installer-un-cluster-complètement-à-la-main-pour-sexercer>Installer un cluster complètement à la main pour s&rsquo;exercer</h2><p>On peut également installer Kubernetes de façon encore plus manuelle pour mieux comprendre ses rouages et composants.
Ce type d&rsquo;installation est décrite par exemple ici : <a href=https://github.com/kelseyhightower/kubernetes-the-hard-way target=_blank>Kubernetes the hard way</a>.</p><footer class=footline></footer></article></div></main></div><aside id=sidebar class="default-animation showVisitedLinks"><div id=header-wrapper class=default-animation><div id=header class=default-animation><a id=logo href=https://zaggash.github.io/tp-iut-kubernetes/><img src=https://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Kubernetes_logo_without_workmark.svg/247px-Kubernetes_logo_without_workmark.svg.png alt="k8s logo"></a></div><div class="searchbox default-animation"><i class="fas fa-search" title="Rechercher (CTRL+ALT+f)"></i>
<label class=a11y-only for=search-by>Rechercher</label>
<input data-search-input id=search-by name=search-by class=search-by type=search placeholder=Rechercher...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script>var contentLangs=["fr"]</script><script src=../js/auto-complete.js defer></script>
<script src=../js/lunr/lunr.min.js defer></script>
<script src=../js/lunr/lunr.stemmer.support.min.js defer></script>
<script src=../js/lunr/lunr.multi.min.js defer></script>
<script src=../js/lunr/lunr.fr.min.js defer></script>
<script src=../js/search.js defer></script></div><div id=homelinks class=default-animation><ul><li><a class=padding href=../><i class="fas fa-home"></i> Home</a></li></ul></div><div id=content-wrapper class=highlightable><ul class="topics enlarge morespace"><li data-nav-id=/cours1_presentation_kubernetes/><a class=padding href=../cours1_presentation_kubernetes/><b>1. </b>Presentation de Kubernetes<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cours2_installation_kubernetes/ class=active><a class=padding href=../cours2_installation_kubernetes/><b>2. </b>Installer Kubernetes<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/td1-installation/><a class=padding href=../td1-installation/><b>3. </b>TD - Installation et Configuration<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cours3_objets_kubernetes_partie1/><a class=padding href=../cours3_objets_kubernetes_partie1/><b>4. </b>Les objets Kubernetes - Partie 1<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/td2-deployer-wordpress/><a class=padding href=../td2-deployer-wordpress/><b>5. </b>TD - Deployer Wordpress<i class="fas fa-check read-icon"></i></a></li></ul><div id=shortcuts><div class="nav-title padding">Aller plus loin</div><ul class=space><li><a class=padding href=https://kubernetes.io/fr/docs/home/><i class="fab fa-book"></i> Documentation Kubernetes</a></li><li><a class=padding href=https://github.com/zaggash/tp-iut-kubernetes><i class="fab fa-github"></i> Dépôt du TP</a></li><li><a class=padding href=https://www.linkedin.com/in/alexandre-pinon/><i class="fab fa-linkedin"></i> Profil Linkedin</a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"></div><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVisitedLinks"><ul><li id=select-language-container class=footerLangSwitch><div class="padding select-container"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=select-style><label class=a11y-only for=select-language>Langue</label>
<select id=select-language onchange="location=baseUri+this.value"></select></div><div class=select-clear></div></div></li><li id=select-variant-container class=footerVariantSwitch><div class="padding select-container"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=select-style><label class=a11y-only for=select-variant>Thème</label>
<select id=select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=blue value=blue selected>Blue</option></select></div><div class=select-clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class="footerVisitedLinks showVisitedLinks"><button class=padding onclick=clearHistory()><i class="fas fa-history fa-fw"></i><span>&nbsp;</span>Supprimer l'historique</button></li></ul></div><div id=footer class="footerFooter showFooter"><center><p>Créé pour l'IUT Reims-Chalons-Charleville - Alexandre P.</p></center></div></div></aside><script src=../js/clipboard.min.js defer></script>
<script src=../js/perfect-scrollbar.min.js defer></script>
<script>function useMathJax(e){if(!Object.assign)return;window.MathJax=Object.assign(window.MathJax||{},{loader:{load:["[tex]/mhchem"]},startup:{elements:[".math"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]]},options:{enableMenu:!1}},e)}useMathJax(JSON.parse("{}"))</script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<script src=../js/d3/d3-color.min.js defer></script>
<script src=../js/d3/d3-dispatch.min.js defer></script>
<script src=../js/d3/d3-drag.min.js defer></script>
<script src=../js/d3/d3-ease.min.js defer></script>
<script src=../js/d3/d3-interpolate.min.js defer></script>
<script src=../js/d3/d3-selection.min.js defer></script>
<script src=../js/d3/d3-timer.min.js defer></script>
<script src=../js/d3/d3-transition.min.js defer></script>
<script src=../js/d3/d3-zoom.min.js defer></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js defer></script>
<script>window.themeUseMermaid=JSON.parse('{ "theme": "default" }')</script><script src=https://cdn.jsdelivr.net/npm/rapidoc/dist/rapidoc-min.js defer></script>
<script>window.themeUseSwagger=JSON.parse('{ "theme": "light" }')</script><script src=../js/theme.js defer></script></body></html>